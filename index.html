<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>TaskFlow - Student Task Manager</title>
    <link rel="stylesheet" href="css/style.css?v=20">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;600;700&family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Left Sidebar Navigation -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h1 class="app-title">TaskFlow</h1>
        </div>
        <ul class="nav-links">
            <li><a href="#" data-page="dashboard" class="nav-link active">
                <span class="icon">üè†</span>
                <span>Dashboard</span>
            </a></li>
            <li><a href="#" data-page="storage" class="nav-link">
                <span class="icon">üíæ</span>
                <span>Storage</span>
            </a></li>

            <!-- Tools Section (collapsible on desktop) -->
            <li class="nav-section">
                <button class="nav-section-toggle" id="tools-toggle">
                    <span class="icon">üõ†Ô∏è</span>
                    <span>Tools</span>
                    <span class="toggle-icon">‚ñº</span>
                </button>
                <ul class="nav-subsection" id="tools-section">
                    <li><a href="#" data-page="notes" class="nav-link nav-sublink">
                        <span class="icon">üìù</span>
                        <span>Notes</span>
                    </a></li>
                    <li><a href="#" data-page="calendar" class="nav-link nav-sublink">
                        <span class="icon">üìÖ</span>
                        <span>Calendar</span>
                    </a></li>
                    <li><a href="#" data-page="timer" class="nav-link nav-sublink">
                        <span class="icon">‚è±Ô∏è</span>
                        <span>Timer</span>
                    </a></li>
                    <li><a href="#" data-page="wheel" class="nav-link nav-sublink">
                        <span class="icon">üéØ</span>
                        <span>Wheel</span>
                    </a></li>
                </ul>
            </li>

            <li><a href="#" data-page="settings" class="nav-link">
                <span class="icon">‚öôÔ∏è</span>
                <span>Settings</span>
            </a></li>

            <!-- Mobile More button -->
            <li class="nav-link-mobile-only"><a href="#" id="more-menu-btn" class="nav-link">
                <span class="icon">‚ãÆ</span>
                <span>More</span>
            </a></li>
        </ul>
    </nav>

    <!-- More Menu Popup (Mobile Only) -->
    <div class="more-menu-overlay" id="more-menu-overlay">
        <div class="more-menu">
            <div class="more-menu-header">
                <h3>More Options</h3>
                <button class="close-more-menu" id="close-more-menu">‚úï</button>
            </div>
            <div class="more-menu-items">
                <a href="#" data-page="notes" class="more-menu-item">
                    <span class="icon">üìù</span>
                    <span>Notes</span>
                </a>
                <a href="#" data-page="calendar" class="more-menu-item">
                    <span class="icon">üìÖ</span>
                    <span>Calendar</span>
                </a>
                <a href="#" data-page="timer" class="more-menu-item">
                    <span class="icon">‚è±Ô∏è</span>
                    <span>Focus Timer</span>
                </a>
                <a href="#" data-page="wheel" class="more-menu-item">
                    <span class="icon">üéØ</span>
                    <span>Spin Wheel</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
            <h2 class="page-title">Dashboard</h2>
            <div class="top-bar-actions">
                <button class="btn-icon quick-search" title="Quick Search">
                    <span>üîç</span>
                </button>
                <button class="btn-icon theme-toggle" title="Toggle Theme">
                    <span>üåô</span>
                </button>
                <button class="btn-icon" id="top-menu-btn" title="Menu">
                    <span>‚ò∞</span>
                </button>
            </div>
        </header>

        <!-- Top Menu Dropdown -->
        <div class="top-menu-dropdown" id="top-menu-dropdown">
            <div class="top-menu-item" id="toggle-nav-item">
                <span class="icon" id="nav-toggle-icon">‚¨áÔ∏è</span>
                <span>Toggle Navigation</span>
            </div>
            <div class="top-menu-divider"></div>
            <div id="top-menu-user-section">
                <!-- User info or sign in button will be inserted here -->
            </div>
        </div>

        <!-- Page Content Container -->
        <div class="page-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <div class="overall-progress-section">
                    <h3>Overall Progress</h3>
                    <div class="overall-progress-bar-container">
                        <div id="overall-progress-segments"></div>
                    </div>
                    <div class="overall-progress-stats" id="overall-progress-stats"></div>
                </div>

                <div class="page-header">
                    <h3>My Subjects</h3>
                    <button class="btn btn-primary" id="add-subject-btn">+ Add Subject</button>
                </div>
                <div class="subjects-grid" id="subjects-grid">
                    <!-- Subject cards will be dynamically inserted here -->
                </div>
            </div>

            <!-- Subject Detail Page -->
            <div id="subject-detail-page" class="page">
                <div class="page-header">
                    <button class="btn-back" id="back-to-dashboard">‚Üê Back</button>
                    <h3 id="subject-title">Subject Name</h3>
                    <div class="subject-actions">
                        <button class="btn btn-secondary" id="subject-folder-btn" title="Open Subject Folder">üìÅ Folder</button>
                        <button class="btn btn-secondary" id="edit-subject-btn">Edit</button>
                        <button class="btn btn-danger" id="delete-subject-btn">Delete</button>
                    </div>
                </div>

                <div class="subject-progress-compact">
                    <div class="progress-header">
                        <span class="progress-label">Progress</span>
                        <span class="progress-text"><strong id="completed-count">0</strong> / <strong id="total-count">0</strong> Complete (<span id="progress-percent">0</span>%)</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="subject-sections">
                    <!-- Assignments Section -->
                    <section class="section">
                        <div class="section-header">
                            <h4>Assignments</h4>
                            <div class="assignment-filters">
                                <select id="assignment-filter">
                                    <option value="all">All</option>
                                    <option value="incomplete">Incomplete</option>
                                    <option value="completed">Completed</option>
                                    <option value="archived">Archived</option>
                                </select>
                                <button class="btn btn-primary btn-sm" id="add-assignment-btn">+ Add Assignment</button>
                            </div>
                        </div>
                        <div class="assignments-list" id="assignments-list">
                            <!-- Assignments will be inserted here -->
                        </div>
                    </section>

                    <!-- Links Section -->
                    <section class="section">
                        <div class="section-header">
                            <h4>Study Resources</h4>
                            <button class="btn btn-primary btn-sm" id="add-link-btn">+ Add Link</button>
                        </div>
                        <div class="links-list" id="links-list">
                            <!-- Links will be inserted here -->
                        </div>
                    </section>
                </div>
            </div>

            <!-- Notes Page -->
            <div id="notes-page" class="page">
                <div class="notes-container">
                    <div class="notes-sidebar">
                        <div class="notes-header">
                            <h3>Notes</h3>
                            <button class="btn btn-primary btn-sm" id="new-note-btn">+ New</button>
                        </div>
                        <div class="notes-list" id="notes-list">
                            <!-- Note items will be inserted here -->
                        </div>
                    </div>
                    <div class="notes-editor">
                        <div class="editor-header">
                            <input type="text" class="note-title-input" id="note-title" placeholder="Note title...">
                            <select class="note-subject-select" id="note-subject">
                                <option value="">No subject</option>
                                <!-- Subjects will be populated here -->
                            </select>
                        </div>
                        <div class="editor-toolbar">
                            <button class="btn-icon" data-command="bold" title="Bold (Ctrl+B)"><strong>B</strong></button>
                            <button class="btn-icon" data-command="italic" title="Italic (Ctrl+I)"><em>I</em></button>
                            <button class="btn-icon" data-command="underline" title="Underline (Ctrl+U)"><u>U</u></button>
                            <button class="btn-icon" data-command="insertUnorderedList" title="Bullet List">‚Ä¢</button>
                            <button class="btn-icon" data-command="insertOrderedList" title="Numbered List">1.</button>
                            <select class="heading-select" data-command="formatBlock">
                                <option value="p">Normal</option>
                                <option value="h1">Heading 1</option>
                                <option value="h2">Heading 2</option>
                                <option value="h3">Heading 3</option>
                            </select>
                            <div class="highlight-colors">
                                <button class="btn-color" data-color="#FFEB3B" style="background:#FFEB3B" title="Yellow Highlight"></button>
                                <button class="btn-color" data-color="#4CAF50" style="background:#4CAF50" title="Green Highlight"></button>
                                <button class="btn-color" data-color="#2196F3" style="background:#2196F3" title="Blue Highlight"></button>
                                <button class="btn-color" data-color="#FF5722" style="background:#FF5722" title="Red Highlight"></button>
                            </div>
                        </div>
                        <div class="editor-content" id="editor-content" contenteditable="true">
                            <p>Start typing your notes here...</p>
                        </div>
                        <div class="editor-footer">
                            <span class="last-edited" id="last-edited">Not saved</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Page -->
            <div id="calendar-page" class="page">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="btn-icon" id="prev-month">‚Üê</button>
                        <h3 id="calendar-month-year">October 2025</h3>
                        <button class="btn-icon" id="next-month">‚Üí</button>
                    </div>
                    <div class="calendar-grid" id="calendar-grid">
                        <!-- Calendar will be generated here -->
                    </div>
                    <div class="calendar-sidebar">
                        <h4 id="selected-date-title">Today's Tasks</h4>
                        <div class="selected-date-tasks" id="selected-date-tasks">
                            <!-- Tasks for selected date -->
                        </div>
                        <button class="btn btn-primary" id="add-calendar-task-btn">+ Add Task</button>
                    </div>
                </div>
            </div>

            <!-- Storage Page -->
            <div id="storage-page" class="page">
                <div class="page-header">
                    <h3>File Storage</h3>
                    <button class="btn btn-primary" id="upload-file-btn">+ Upload File</button>
                    <input type="file" id="file-input" style="display:none" multiple>
                </div>
                <div class="storage-content">
                    <div class="folders-list" id="folders-list">
                        <!-- Subject folders will be shown here -->
                    </div>
                    <div class="files-list" id="files-list">
                        <!-- Files will be shown here -->
                    </div>
                </div>
            </div>

            <!-- Timer Page -->
            <div id="timer-page" class="page">
                <div class="timer-container">
                    <h3>Focus Timer</h3>
                    <div class="timer-display">
                        <svg class="timer-ring" width="300" height="300">
                            <circle class="timer-ring-bg" cx="150" cy="150" r="130" />
                            <circle class="timer-ring-progress" cx="150" cy="150" r="130" id="timer-progress-ring" />
                        </svg>
                        <div class="timer-time">
                            <span id="timer-display">25:00</span>
                        </div>
                    </div>
                    <div class="timer-controls">
                        <button class="btn btn-primary" id="timer-start">Start</button>
                        <button class="btn btn-secondary" id="timer-pause" disabled>Pause</button>
                        <button class="btn btn-secondary" id="timer-reset">Reset</button>
                    </div>
                    <div class="timer-settings">
                        <label>Duration (minutes):</label>
                        <input type="number" id="timer-duration" value="25" min="1" max="120">
                    </div>
                </div>
            </div>

            <!-- Wheel Page -->
            <div id="wheel-page" class="page">
                <div class="wheel-container">
                    <h3>Spin the Wheel</h3>
                    <p class="wheel-subtitle">Can't decide what to study? Let the wheel choose!</p>
                    <div class="wheel-display">
                        <canvas id="wheel-canvas" width="400" height="400"></canvas>
                    </div>
                    <button class="btn btn-primary btn-lg" id="spin-wheel-btn">SPIN!</button>
                    <div class="wheel-result" id="wheel-result"></div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page">
                <h3>Settings</h3>
                <div class="settings-sections">
                    <section class="settings-section">
                        <h4>Preferences</h4>
                        <div class="form-group">
                            <label>Default Timer Duration (minutes)</label>
                            <input type="number" id="default-timer-duration" value="25" min="1" max="120">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enable-notifications" checked>
                                Enable Notifications
                            </label>
                        </div>
                    </section>
                    <section class="settings-section">
                        <h4>Appearance</h4>
                        <div class="form-group">
                            <label>Accent Color</label>
                            <div class="color-picker">
                                <button class="color-option" data-accent="#4A90E2" style="background:#4A90E2" title="Blue"></button>
                                <button class="color-option" data-accent="#E74C3C" style="background:#E74C3C" title="Red"></button>
                                <button class="color-option" data-accent="#2ECC71" style="background:#2ECC71" title="Green"></button>
                                <button class="color-option" data-accent="#F39C12" style="background:#F39C12" title="Orange"></button>
                                <button class="color-option" data-accent="#9B59B6" style="background:#9B59B6" title="Purple"></button>
                                <button class="color-option" data-accent="#1ABC9C" style="background:#1ABC9C" title="Teal"></button>
                                <button class="color-option" data-accent="#00D9FF" style="background:#00D9FF" title="Cyan"></button>
                                <button class="color-option color-plus-btn" id="accent-color-plus" title="Custom Color">+</button>
                            </div>
                            <input type="color" id="accent-color-picker" style="display:none">
                        </div>
                        <div class="form-group">
                            <label>Text Color</label>
                            <div class="color-picker">
                                <button class="color-option" data-text="#FFFFFF" style="background:#FFFFFF; border: 2px solid #333" title="White"></button>
                                <button class="color-option" data-text="#E0E0E0" style="background:#E0E0E0; border: 2px solid #333" title="Light Gray"></button>
                                <button class="color-option" data-text="#FFD700" style="background:#FFD700; border: 2px solid #333" title="Gold"></button>
                                <button class="color-option" data-text="#87CEEB" style="background:#87CEEB; border: 2px solid #333" title="Sky Blue"></button>
                                <button class="color-option" data-text="#98FB98" style="background:#98FB98; border: 2px solid #333" title="Pale Green"></button>
                                <button class="color-option color-plus-btn" id="text-color-plus" title="Custom Color">+</button>
                            </div>
                            <input type="color" id="text-color-picker" style="display:none">
                        </div>
                        <div class="form-group">
                            <label>Font Family</label>
                            <select id="font-family-select">
                                <option value="'Inter', sans-serif">Inter (Default)</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                                <option value="'Open Sans', sans-serif">Open Sans</option>
                                <option value="'Poppins', sans-serif">Poppins</option>
                                <option value="'Montserrat', sans-serif">Montserrat</option>
                                <option value="'Lato', sans-serif">Lato</option>
                                <option value="system-ui, sans-serif">System Font</option>
                                <option value="'Courier New', monospace">Courier New</option>
                                <option value="Georgia, serif">Georgia</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Font Size</label>
                            <select id="font-size-select">
                                <option value="12px">Small (12px)</option>
                                <option value="14px" selected>Default (14px)</option>
                                <option value="16px">Medium (16px)</option>
                                <option value="18px">Large (18px)</option>
                                <option value="20px">Extra Large (20px)</option>
                            </select>
                        </div>
                    </section>
                    <section class="settings-section">
                        <h4>Data Management</h4>
                        <button class="btn btn-secondary" id="export-data-btn">Export Data (JSON)</button>
                        <button class="btn btn-secondary" id="import-data-btn">Import Data</button>
                        <input type="file" id="import-file-input" accept=".json" style="display:none">
                        <button class="btn btn-danger" id="clear-data-btn">Clear All Data</button>
                    </section>
                    <section class="settings-section">
                        <h4>About</h4>
                        <p>Student Task Manager v1.0</p>
                        <p>Built to help students organize their coursework effectively.</p>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Add Subject Modal -->
    <div class="modal" id="add-subject-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Subject</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Subject Name</label>
                    <input type="text" id="subject-name-input" placeholder="e.g., Biology">
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <div class="color-picker">
                        <button class="color-option" data-color="#4A90E2" style="background:#4A90E2"></button>
                        <button class="color-option" data-color="#E74C3C" style="background:#E74C3C"></button>
                        <button class="color-option" data-color="#2ECC71" style="background:#2ECC71"></button>
                        <button class="color-option" data-color="#F39C12" style="background:#F39C12"></button>
                        <button class="color-option" data-color="#9B59B6" style="background:#9B59B6"></button>
                        <button class="color-option" data-color="#1ABC9C" style="background:#1ABC9C"></button>
                        <button class="color-option selected" data-color="#34495E" style="background:#34495E"></button>
                        <button class="color-option" data-color="#E91E63" style="background:#E91E63"></button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="save-subject-btn">Save</button>
            </div>
        </div>
    </div>

    <!-- Add Assignment Modal -->
    <div class="modal" id="add-assignment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Assignment</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Assignment Title</label>
                    <input type="text" id="assignment-title-input" placeholder="e.g., Chapter 5 Quiz">
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" id="assignment-date-input">
                </div>
                <div class="form-group">
                    <label>Due Time (Optional)</label>
                    <input type="time" id="assignment-time-input" placeholder="Leave empty if not needed">
                </div>
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="assignment-notes-input" rows="3" placeholder="Focus on sections 5.2-5.4"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="save-assignment-btn">Save</button>
            </div>
        </div>
    </div>

    <!-- Add Link Modal -->
    <div class="modal" id="add-link-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Link</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>URL</label>
                    <input type="url" id="link-url-input" placeholder="https://youtube.com/watch?v=...">
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="link-title-input" placeholder="e.g., Photosynthesis Explained">
                </div>
                <div class="form-group">
                    <label>Description (Optional)</label>
                    <input type="text" id="link-desc-input" placeholder="Khan Academy video">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="save-link-btn">Save</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.2.4/dist/dexie.min.js"></script>

    <!-- Firebase v9 - Compat mode for non-module usage -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script src="js/storage.js?v=20"></script>
    <script src="js/firebase-sync.js?v=20"></script>
    <script src="js/utils.js?v=20"></script>
    <script src="js/subjects.js?v=20"></script>
    <script src="js/assignments.js?v=20"></script>
    <script src="js/notes.js?v=20"></script>
    <script src="js/calendar.js?v=20"></script>
    <script src="js/timer.js?v=20"></script>
    <script src="js/wheel.js?v=20"></script>
    <script src="js/app.js?v=20"></script>
</body>
</html>
